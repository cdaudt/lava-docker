# Sample JOB definition for an x86_64 QEMU
device_type: qemu
job_name: kvm-pipeline

timeouts:
  actions:
    apply-overlay-image:
      minutes: 2
    umount-retry:
      seconds: 57
    lava-test-shell:
      seconds: 300
  job:
    minutes: 45
  action:
    minutes: 20
priority: medium
visibility: public
context:
  arch: amd64

actions:

   - deploy:
       timeout:
         minutes: 20
       to: tmpfs
       images:
           rootfs:
             image_arg: -drive format=raw,file={rootfs}
             url: http://rodan.ric.broadcom.com/images/amoore/kvm-debian-wheezy.img.gz
             compression: gz
       os: debian
       root_partition: 1

   - boot:
       method: qemu
       media: tmpfs
       prompts: ["root@debian:"]
       failure_retry: 2

   - test:
       failure_retry: 3
       name: kvm-basic-singlenode
       timeout:
         minutes: 10 # uses install:deps, so takes a few minutes
       definitions:
           - repository: git://git.linaro.org/qa/test-definitions.git
             from: git
             path: ubuntu/smoke-tests-basic.yaml
             name: smoke-tests
           - repository: http://git.linaro.org/lava-team/lava-functional-tests.git
             from: git
             path: lava-test-shell/single-node/singlenode03.yaml
             name: singlenode-advanced
